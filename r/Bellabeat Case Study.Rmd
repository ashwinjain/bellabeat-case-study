---
title: "Bellabeat Case Study"
author: "Ashwin Jain"
date: "8/18/2023"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Installing Packages

For this, I've installed these packages

'readxl', 'Rcpp', 'magrittr', 'dplyr', 'janitor'

```{r install}
library(readxl)
library(Rcpp)
library(magrittr)
library(dplyr)
library(janitor)
```

# Importing Data

We first need to load in our data. It was downloaded as csv files which I then exported to Excel for visual purposes

```{r import}
daily_activity = read_excel("/Users/ashwinjain/Development/Personal/bellabeat-case-study/data/dailyActivity_merged.xlsx")
daily_sleep = read_excel("/Users/ashwinjain/Development/Personal/bellabeat-case-study/data/sleepDay_merged.xlsx")
```

# Cleaning Data

## daily_activity

We will first work with the daily_activity dataset

```{r view daily_activity, echo=FALSE}

knitr::kable(daily_activity[1:5, ], caption="Preview of dailyActivities_merged")

col_before = colnames(daily_activity)
```

First, check the sample size

```{r sample size}
n_distinct(daily_activity$Id)
n_distinct(daily_sleep$Id)
```

We see the sample size of daily activities is 33 and for daily sleep, it is 24. While this is lower than the reccomended 30, for our educational purposes, this is okay

Second, I deleted the SedentaryActiveDistance column - many of these entries had values over 0, which doesn't make sense because being sedentary and on the move are mutually exclusive

Second, I decided we should check for duplicated data and remove extras

```{r dup}
sum(duplicated(daily_activity) == TRUE)
sum(duplicated(daily_sleep) == TRUE)
```

The duplicated function outputs a list where the value of each indice in the list corresponds to whether that row is unique or not. The sum of all the TRUE values is 0, therefore, there are no duplicates

For the daily_sleep dataset however, there are 3 duplicates. We must reomve these duplicates as follows

```{r remove duplicates}
daily_sleep <- unique(daily_sleep)
sum(duplicated(daily_sleep) == TRUE)
```

Third, we should remove irrelevant data. There are few things to consider here. First, the SedentaryActiveDistance column - this does not matter as sedentary distance will always be zero.

A few of the data points have sedentary distances greater than zero, which is an error.

```{r distance>0 d}
sum(daily_activity$SedentaryActiveDistance > 0)
```

As we can see, there are 82 days amoungst these individuals where the technology logged distance traveled while the person was moving, so it should be removed

```{r delete SedentaryActiveDistance}
daily_activity <- select(daily_activity, -SedentaryActiveDistance)
```

List of columns before - 15 total

```{r before, echo=FALSE}
col_before
```

List of columns after - 14 total

```{r after, echo=FALSE}
colnames(daily_activity)
```

Furthermore, there are many days where users logged 0 for many, if not all of the columns. This is likely because the user forgot to wear their technology. We are going to remove this from the table. However, we will store the data in a separate table, as it may prove useful later.

I am checking for calories burned to be less than 1000. Barring medical conditions, it is impossible to have a metabolic rate less than 1000 calories

```{r notworn}
not_worn = subset(daily_activity, Calories < 1000)
daily_activity <- subset(daily_activity, Calories > 1000)
daily_activity
```

Rename columns

We can then rename the columns for a more standardized format

```{r rename}
clean_names(daily_activity)
clean_names(daily_sleep)
names(daily_activity) <- tolower(names(daily_activity))
names(daily_sleep) <- tolower(names(daily_sleep))
colnames(daily_activity)[2] = "date"
colnames(daily_sleep)[2] = "date"
glimpse(daily_activity)
glimpse(daily_sleep)
```

Typically, we would like to rename the date column to provide a consistent format. However, the date column is already formatted properly, so this step is redundant

We next want to merge the daily_activity and daily_sleep columns by id and date. We must make sure both tables have the same column names for this.

Merge daily sleep and daily activity

```{r merge}
daily_activity_sleep <- merge(daily_activity, daily_sleep, by=c ("id", "date"))
daily_activity_sleep
```

# Processing Data

The first step in processing data is understanding our subjects average behaviour. From the daily_activity_sleep table, we can extract average values for totalsteps, totaldistance, veryactivedistance, moderatelyactivedistance, lightactivedistance, veryactiveminutes, fairlyactiveminutes, lightlyactiveminutes, sedentaryminutes, calories, and totalminutesasleep

We will source every variable from the daily_activity table, with the exception of totalminutesasleep, which we will obtain from the daily_sleep table

```{r sum}
daily_activity_grouped <- daily_activity %>%
+     group_by(id) %>% 
+     transmute(totalsteps=sum(totalsteps), totaldistance=sum(totaldistance), veryactivedistance = sum(veryactivedistance), moderatelyactivedistance = sum(moderatelyactivedistance), lightactivedistance=sum(lightactivedistance), veryactiveminutes=sum(veryactiveminutes), fairlyactiveminutes=sum(fairlyactiveminutes), lightlyactiveminutes=sum(lightlyactiveminutes), sedentaryminutes=sum(sedentaryminutes), calories=sum(calories))

daily_activity_grouped <- unique(daily_activity_grouped)

daily_sleep_grouped <- daily_sleep %>% group_by(id) %>% transmute(totalminutesasleep=sum(totalminutesasleep))

daily_sleep_grouped <- unique(daily_sleep_grouped)
daily_activity_sleep_grouped <- merge(daily_activity_grouped, daily_sleep_grouped, by=c ("id"))

```

## TODO

Maybe add the weight dataset just for the purposes of showing that the low metabolic rate is impossible for them analyze the not worn dataset
